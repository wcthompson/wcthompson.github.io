<script src="../lib/jquery-1.11.1.min.js"></script>
<script src="../lib/subcollider.js"></script>
<script src="../lib/timbre.js"></script>
<script src="../lib/p5.min.js"></script>
<script src="../lib/p5.sound.js"></script>
<script src="../lib/responsivevoice.js"></script>

<link href="https://fonts.googleapis.com/css?family=Arvo:400i|Permanent+Marker" rel="stylesheet">

<title>Spooky Scary Skeletons</title>

<style type="text/css">
  body {
    background: url(twinkle.gif) repeat;
  }

  h1 {
    text-align: center;
    font-size: 5em;
    font-family: Arial black;
    margin-top: 10%;
    color: white;
    z-index: 999;
  }

  #static-div {
    width: 100%;
    height: 100%;
    position: absolute;
    display: fixed;
  }

  .btn {
    -webkit-border-radius: 6;
    -moz-border-radius: 6;
    border-radius: 6px;
    font-family: Arial;
    color: #ffffff;
    font-size: 20px;
    background: #3498db;
    padding: 10px 20px 10px 20px;
    text-decoration: none;
  }

  .btn:hover {
    background: #3cb0fd;
    text-decoration: none;
    cursor: pointer;
  }

  #play {
    width: 70px;
    padding: 0 0 5px 5px;
  }

  .gif img {
    z-index: 0;
    max-width: 200px;
    position: absolute;
  }

.shaking {
  animation: shake infinite cubic-bezier(.36,.07,.19,.97) both ;
  transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
  perspective: 1000px; 
}

@keyframes shake {
  10%, 90% {
    transform: translate3d(-1px, 0, 0);
  }
  
  20%, 80% {
    transform: translate3d(2px, 0, 0);
  }

  30%, 50%, 70% {
    transform: translate3d(-4px, 0, 0);
  }

  40%, 60% {
    transform: translate3d(4px, 0, 0);
  }
}
</style>
<script type="text/javascript">
/* timbre stuff I only kinda understand */
var playing = false;
var count = 0;
var msec  = timbre.timevalue("bpm120 l8");
var midis = [69, 71, 72, 76, 69, 71, 72, 76];
var synth = T("OscGen", {wave:"saw", mul:0.050}).play();

// set up processing
var sound, amplitude;
var isNotLoud = true;
var txt = "Spooky scary skeletons send shivers down your spine. Shrieking skulls will shock your soul seal your doom tonight. Spooky, scary skeletons speak with such a screech. You'll shake and shudder in surprise When you hear these zombies shriek. We're so sorry, skeletons. You're so misunderstood. You only want to socialize, but I don't think we should... 'Cause spooky, scary skeletons Shout startling shrilly screams. They'll sneak from their sarcophagus And just won't leave you be. Spirits supernatural are shy, what's all the fuss? But bags of bones seem so unsafe. It's semi-serious. Spooky scary skeletons are silly all the same...They'll smile and scrabble slowly by... And drive you so insane. Sticks and stones will break your bones. They seldom let you snooze. Spooky scary skeletons will wake you with a boo!"
var timer = 0;

function tick() {
  count = 0

  if (! (timer >= txt.length )) {
    $('h1').append(txt[timer] + " ")
    speak(txt[timer], 1);
  }
  // reshuffle array of midi notes on tick to change progression
  if (timer % 2 == 0){
    $("html, body").animate({ scrollTop: $("#static-div")[0].scrollHeight - parseInt(screen.height) + 50 }, 500);
    midis = midis.shuffle();
    T("interval", {interval:msec}, function(count) {
      if (count < midis.length) {
        synth.noteOn(midis[count], 100);
      } 
    }).start();
  } 
  timer++;

  if (timer % 10 == 0) {
    makeDiv();
  }

  if (timer % 7 == 0) {
    $('h1').addClass('shaking')

  }
}

function preload() {
  txt = txt.split(" ")
}
function setup() {
  amplitude = new p5.Amplitude();
}
function draw() {
}

//handle gif generation
var IMG_DIR = 'img/'
var images = ['chair.gif', 'coffee.gif', 'dancing_1.gif', 'dootdoot.gif', 'with_pirate_hat.gif', 'pepsi.gif', 'computer.gif', 'cds.gif', 'with_sword.gif', 'dancing_2.gif', 'giphy.gif', 'dancing_3.gif', 'cartoon_walk.gif', 'spinning.gif']
function makeDiv(){
  // vary size for fun
  var divsize = ((Math.random()*100) + 50).toFixed();
  
  $newdiv = $('<div/>').css({
      'width':divsize+'px',
      'height':divsize+'px'
  });
  var imgName = images.shuffle()[0]
  var img = $('<img id="dynamic">'); //Equivalent: $(document.createElement('img'))
  img.attr('src', IMG_DIR + imgName);
  img.appendTo($newdiv);
  // make position sensitive to size and document's width
  var doc = document.documentElement;
  var top = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);

  var posx = (Math.random() * ($(document).width() - divsize)).toFixed();
  var posy = (Math.random() * (screen.height  - divsize)).toFixed();
  //posy += top;
  console.log (posy);
  console.log(top);

  console.log(posy);

  var delay = Math.random() *500 + 1000 - min(1000, timer*5);
  console.log(timer)

  //taken from stack overflow, finds window scroll position
  $newdiv.addClass('gif')
  $newdiv.css({
      'position': 'absolute',
      'left':posx+'px',
      'top':parseInt(top)+parseInt(posy) + 'px',
      'display':'none'
  }).appendTo( 'body' ).fadeIn(100).delay(delay).fadeOut(500, function(){
    $(this).remove();
    makeDiv(); 
  }); 
}

// 'main'
$(document).ready(function() {  
  $('#play').click(function() {
    setInterval(tick, 750)
    makeDiv();
    makeDiv();
    $('#play').hide();
  });
});

function speak(string, rate){
    //rate should be between 0.0 and 2.0
    responsiveVoice.speak(string, "Russian Female", {rate: rate, pitch: 1})
}

</script>

<body>
  <div id="play" class="btn"> 
    START
  </div>  

  <div id="static-div">
    <h1></h1>
  </div>
</body>